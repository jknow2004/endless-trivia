<!-- /index.html
Endless Trivia – Vue 2 (Geography added, no score, fixed modal placement)
- Vue-driven screens
- Answer highlight + feedback modal (inside #app)
- Endless questions via fresh fetch when batch ends
-->
<!DOCTYPE html>
<html lang="en" class="bg-gray-100">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Endless Trivia</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    [v-cloak] { display: none; }
  </style>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          animation: { fade: 'fadeIn 0.3s ease-in-out', pop: 'pop 0.4s ease-out' },
          keyframes: {
            fadeIn: { '0%': { opacity: 0 }, '100%': { opacity: 1 } },
            pop: { '0%': { transform: 'scale(0.9)', opacity: 0 }, '100%': { transform: 'scale(1)', opacity: 1 } }
          }
        }
      }
    }
  </script>
</head>
<body class="font-sans text-gray-800">
  <div id="app" v-cloak class="p-4 max-w-5xl mx-auto">
    <!-- Home Screen -->
    <div v-if="screen === 'home'" class="animate-fade">
      <h1 class="text-5xl font-extrabold text-center mb-2 text-indigo-600 drop-shadow-sm">Endless Trivia</h1>
      <p class="text-center mb-8 text-gray-600 text-lg">Test your knowledge across various categories</p>
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
        <div @click="selectCategory('Shuffle All')" class="cursor-pointer bg-gradient-to-r from-purple-500 to-pink-500 text-white p-6 rounded-2xl text-center shadow hover:from-pink-500 hover:to-purple-400 transition-all duration-300">
          <div class="text-4xl mb-2">🔀</div>
          <h2 class="text-2xl font-bold">Shuffle All</h2>
          <p>Mix questions from all categories</p>
        </div>
        <div v-for="category in categories" :key="category.name" @click="selectCategory(category.name)"
             class="cursor-pointer bg-white p-6 rounded-2xl text-center shadow hover:bg-indigo-100 transition-all duration-300">
          <div class="text-3xl mb-2">{{ category.icon }}</div>
          <h2 class="text-xl font-semibold">{{ category.name }}</h2>
          <p class="text-gray-500 text-sm">{{ category.desc }}</p>
        </div>
      </div>
    </div>

    <!-- Game Screen -->
    <div v-else-if="screen === 'game'" class="animate-fade">
      <div class="flex items-center mb-6">
        <button @click="goHome" class="text-indigo-600 font-semibold hover:underline">Back to Categories</button>
      </div>

      <div class="bg-white p-6 rounded-2xl shadow-lg animate-fade">
        <p class="text-2xl font-semibold mb-4">{{ currentQuestion.question }}</p>
        <div class="space-y-3">
          <button v-for="option in currentQuestion.options" :key="option"
                  @click="selectAnswer(option)"
                  :disabled="Boolean(selectedAnswer)"
                  :class="['w-full text-left p-4 rounded-lg border transition-all duration-200',
                           'hover:bg-gray-50',
                           answerClass(option),
                           selectedAnswer ? 'cursor-default' : 'cursor-pointer']">
            {{ option }}
          </button>
        </div>
      </div>
    </div>

    <!-- Feedback Modal (INSIDE #app so Vue controls it) -->
    <div v-if="showFeedback" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50">
      <div class="bg-white p-6 rounded-xl shadow-xl text-center animate-pop w-96" role="dialog" aria-modal="true">
        <p class="text-2xl font-bold mb-2" :class="feedbackIsCorrect ? 'text-green-600' : 'text-red-600'">
          {{ feedbackMessage }}
        </p>
        <p v-if="feedbackIsCorrect" class="text-sm text-gray-500 mb-4">Nice work — keep it going.</p>
        <p v-else class="text-sm text-gray-500 mb-4">You'll nail the next one.</p>
        <div class="flex items-center justify-center gap-3">
          <button @click="handleNextFromModal" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600">Next Question</button>
          <button @click="goHomeFromModal" class="bg-gray-100 text-gray-800 px-4 py-2 rounded hover:bg-gray-200 border">Back to Home</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
  <script>
    function shuffle(array) {
      let i = array.length, r;
      while (i) { r = Math.floor(Math.random() * i--); [array[i], array[r]] = [array[r], array[i]]; }
      return array;
    }

    new Vue({
      el: '#app',
      data: {
        screen: 'home',
        categories: [
          { name: 'Movies', icon: '🎬', desc: 'Test your film knowledge', id: 11 },
          { name: 'TV Shows', icon: '📺', desc: 'From classics to current hits', id: 14 },
          { name: 'Music', icon: '🎵', desc: 'All music eras', id: 12 },
          { name: 'Sports', icon: '⚽', desc: 'Sports trivia', id: 21 },
          { name: 'Video Games', icon: '🎮', desc: 'Retro to modern', id: 15 },
          { name: 'Books', icon: '📚', desc: 'Literature and more', id: 10 },
          { name: 'Science', icon: '🔬', desc: 'Scientific facts', id: 17 },
          { name: 'Geography', icon: '🌍', desc: 'World places & facts', id: 22 }
        ],
        fullQuestionBank: {},
        currentQuestions: [],
        currentCategory: '',
        currentCategoryId: null,
        questionIndex: 0,
        currentQuestion: { question: '', options: [] },
        selectedAnswer: '',
        correctAnswer: '',
        showFeedback: false,
        feedbackMessage: '',
        feedbackIsCorrect: false
      },
      mounted() {
        // Ensure no popup at start
        this.showFeedback = false;
      },
      methods: {
        selectCategory(categoryName) {
          this.currentCategory = categoryName;
          this.currentCategoryId = this.categories.find(c => c.name === categoryName)?.id || null;
          this.selectedAnswer = '';
          this.correctAnswer = '';
          this.showFeedback = false; // guard against stale state
          this.loadQuestions();
          this.screen = 'game';
        },
        async loadQuestions() {
          try {
            const parsed = await this.fetchQuestionsBatch();
            if (!parsed.length) {
              alert('No questions available right now. Please pick another category or try again.');
              this.screen = 'home';
              return;
            }
            this.currentQuestions = parsed;
            this.questionIndex = 0;
            this.currentQuestion = this.currentQuestions[this.questionIndex];
          } catch (err) {
            console.error('Failed to load questions:', err);
            alert('Failed to load questions. Check your connection and try again.');
            this.screen = 'home';
          }
        },
        buildApiUrl() {
          let url = 'https://opentdb.com/api.php?amount=50&type=multiple';
          if (this.currentCategory !== 'Shuffle All' && this.currentCategoryId) {
            url += `&category=${this.currentCategoryId}`;
          }
          return url;
        },
        async fetchQuestionsBatch() {
          const res = await fetch(this.buildApiUrl());
          const data = await res.json();
          return (data.results || []).map(q => {
            const decodedQuestion = this.decodeHtml(q.question);
            const correct = this.decodeHtml(q.correct_answer);
            const options = [...q.incorrect_answers.map(this.decodeHtml), correct];
            return { question: decodedQuestion, options: shuffle(options), answer: correct };
          });
        },
        async fetchMoreQuestions() {
          try {
            const parsed = await this.fetchQuestionsBatch();
            if (parsed.length) this.currentQuestions = shuffle([...parsed]);
          } catch (e) { console.error('Failed to fetch more questions:', e); }
        },
        decodeHtml(html) {
          const txt = document.createElement('textarea');
          txt.innerHTML = html; return txt.value;
        },
        selectAnswer(option) {
          if (this.selectedAnswer) return;
          this.selectedAnswer = option;
          this.correctAnswer = this.currentQuestion.answer;
          const isCorrect = option === this.correctAnswer;
          this.feedbackIsCorrect = isCorrect;
          this.feedbackMessage = isCorrect ? this.getRandomRightMessage() : this.getRandomWrongMessage();
          this.showFeedback = true;
        },
        handleNextFromModal() {
          this.showFeedback = false;
          this.nextQuestion();
        },
        goHomeFromModal() {
          this.showFeedback = false;
          this.goHome();
        },
        async nextQuestion() {
          this.selectedAnswer = '';
          this.correctAnswer = '';
          this.questionIndex++;
          if (this.questionIndex >= this.currentQuestions.length) {
            await this.fetchMoreQuestions();
            this.questionIndex = 0;
          }
          this.currentQuestion = this.currentQuestions[this.questionIndex];
        },
        answerClass(option) {
          if (!this.selectedAnswer) return '';
          if (option === this.correctAnswer) return 'bg-green-200 border-green-400';
          if (option === this.selectedAnswer) return 'bg-red-200 border-red-400';
          return '';
        },
        getRandomWrongMessage() {
          const messages = ['Try again!', 'Nice try!', 'Oops!', 'Not quite!', 'Almost!'];
          return messages[Math.floor(Math.random() * messages.length)];
        },
        getRandomRightMessage() {
          const messages = ['Good job!', 'Great work!', 'Well done!', 'Nice one!', 'Correct!'];
          return messages[Math.floor(Math.random() * messages.length)];
        },
        goHome() { this.showFeedback = false; this.screen = 'home'; }
      }
    });
  </script>
</body>
</html>
